<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Історія пацієнтів</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f4f8fb;
        }
        h1 {
            color: #0d6efd;
        }
        .custom-table th {
            background-color: #0d6efd;
            color: white;
            text-align: center;
        }
        .custom-table td {
            text-align: center;
            vertical-align: middle;
        }
        .table-container {
            margin: 40px auto;
            max-width: 1200px;
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .search-bar {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<header th:if="${user.position.equalsIgnoreCase('Головний лікар')}" th:insert="~{blocks/MainDoctorheader :: header}"></header>
<header th:if="${user.position.equalsIgnoreCase('Лікар')}" th:insert="~{blocks/Doctorheader :: header}"></header>
<header th:if="${user.position.equalsIgnoreCase('Медсестра/Медбрат')}" th:insert="~{blocks/Nurseheader :: header}"></header>

<div class="container mt-4">
    <div class="text-center">
        <h1 class="mb-3">Історія пацієнтів</h1>
        <p class="text-muted">Перегляд історії виписаних пацієнтів</p>
    </div>

    <div class="row justify-content-center search-bar">
        <div class="col-md-10">
            <form method="get" th:action="@{/historypatients}">
                <div class="row g-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" name="search" id="search"
                               th:value="${searchTerm}" placeholder="Введіть ім'я, телефон або діагноз...">
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" name="searchType" id="searchType" th:value="${searchType}">
                            <option value="all" th:selected="${searchType == 'all'}">По всіх полях</option>
                            <option value="name" th:selected="${searchType == 'name'}">Ім'я</option>
                            <option value="phone" th:selected="${searchType == 'phone'}">Телефон</option>
                            <option value="diagnosis" th:selected="${searchType == 'diagnosis'}">Діагноз</option>
                            <option value="recordedDATE" th:selected="${searchType == 'recordedDATE'}">Дата запису</option>
                            <option value="dischargeDATE" th:selected="${searchType == 'dischargeDATE'}">Дата виписки</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex">
                        <button type="submit" class="btn btn-primary w-100 me-1">Знайти</button>
                        <a href="/historypatients" class="btn btn-secondary">Очистити</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="alert alert-info text-center" th:if="${searchTerm != null and !searchTerm.isEmpty()}">
        Результати пошуку для "<strong th:text="${searchTerm}"></strong>" (<span th:text="${totalPatients}">0</span> записів знайдено)
    </div>

    <div class="table-container">
        <div th:if="${patients != null and !patients.isEmpty()}">
            <table class="table table-bordered table-hover custom-table">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Ім'я</th>
                    <th>Телефон</th>
                    <th>Діагноз</th>
                    <th>Дата народження</th>
                    <th>Палата</th>
                    <th>Лікар</th>
                    <th>Відділення</th>
                    <th>Прийом</th>
                    <th>Виписка</th>
                    <th>Примітки</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="patient, iterStat : ${patients}">
                    <td th:text="${iterStat.count}">1</td>
                    <td th:text="${patient.fullName}">Ім'я</td>
                    <td th:text="${patient.phone}">Телефон</td>
                    <td th:text="${patient.diagnosis}">Діагноз</td>
                    <td th:text="${#temporals.format(patient.birthDate, 'dd.MM.yyyy')}">Дата народження</td>
                    <td th:text="'Палата ' + ${patient.ward} + ', ліжко ' + ${patient.bed}">Палата</td>
                    <td>
                        <span th:text="${patient.doctor.fullName}"></span>
                        <br/>
                        <small class="text-muted" th:text="${patient.doctor.specialty}"></small>
                    </td>
                    <td th:text="${patient.department}">Відділення</td>
                    <td th:text="${#temporals.format(patient.appointmentDateFrom, 'dd.MM.yyyy HH:mm')}">Прийом</td>
                    <td th:text="${#temporals.format(patient.appointmentDateTo, 'dd.MM.yyyy HH:mm')}">Виписка</td>
                    <td>
                        <span th:if="${patient.notes != null and !patient.notes.isEmpty()}" th:text="${patient.notes}"></span>
                        <span th:if="${patient.notes == null or patient.notes.isEmpty()}" class="text-muted fst-italic">Немає</span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div th:if="${patients == null or patients.isEmpty()}" class="text-center p-5 text-muted">
            <i class="fas fa-search fa-3x mb-3"></i>
            <h4>Записи не знайдено</h4>
            <p th:if="${searchTerm != null and !searchTerm.isEmpty()}">
                За запитом "<strong th:text="${searchTerm}"></strong>" нічого не знайдено.
            </p>
            <p th:if="${searchTerm == null or searchTerm.isEmpty()}">
                Поки що немає записів в історії пацієнтів.
            </p>
            <a th:if="${searchTerm != null and !searchTerm.isEmpty()}" href="/historypatients" class="btn btn-primary mt-2">
                Показати всі записи
            </a>
        </div>
    </div>
</div>
<footer th:insert="~{blocks/footer :: footer}"></footer>
</body>
</html>